<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Offerta Speciale - Biz Starter Pack</title>

  <!-- Meta Pixel Code -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '2180408928835338');
  fbq('track', 'PageView');
  fbq('track', 'Lead');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=2180408928835338&ev=PageView&noscript=1"/></noscript>
  <!-- End Meta Pixel Code -->

  <!-- Stripe -->
  <script src="https://js.stripe.com/v3/"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --neon:#B8FC8D;
      --red:#FF3B3B;
      --gold1:#FFD700; 
      --gold2:#FFA500;
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    
    body{
      font-family:'Oswald',sans-serif;
      color:#fff;
      background:#000;
      overflow-x:hidden;
      min-height:100vh;
      position:relative;
    }

    /* Background con griglia e sfumature */
    .background{
      position:fixed;
      inset:0;
      z-index:0;
      background: 
        radial-gradient(circle at 50% 30%, rgba(184,252,141,.15) 0%, transparent 45%),
        radial-gradient(circle at 50% 70%, rgba(184,252,141,.1) 0%, transparent 50%),
        #000;
    }
    
    .grid{
      position:fixed;
      inset:0;
      z-index:1;
      opacity:.06;
      background-image:
        linear-gradient(rgba(184,252,141,1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(184,252,141,1) 1px, transparent 1px);
      background-size:50px 50px;
    }

    .container{
      max-width:900px;
      margin:0 auto;
      padding:0 20px;
      position:relative;
      z-index:2;
    }

    /* Top Banner PIÙ PICCOLO */
    .top-banner{
      text-align:center;
      padding:10px 0 3px; /* Molto più piccolo come nell'optin */
    }
    
    .live-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 20px; /* Più piccolo */
      border-radius:999px;
      background:rgba(40,40,40,.9);
      backdrop-filter:blur(12px);
      font-size:14px; /* Più piccolo */
      font-weight:400; /* Non grassetto */
      letter-spacing:.1px;
    }
    
    .dot{
      width:8px; /* Più piccolo */
      height:8px;
      border-radius:50%;
      background:var(--neon);
      box-shadow:
        0 0 20px rgba(184,252,141,.9),
        0 0 40px rgba(184,252,141,.6),
        0 0 60px rgba(184,252,141,.4),
        inset 0 0 10px rgba(255,255,255,.5);
      animation:pulse 1.5s infinite;
      filter:brightness(1.2);
    }
    
    @keyframes pulse{
      0%, 100%{
        box-shadow:
          0 0 20px rgba(184,252,141,.9),
          0 0 40px rgba(184,252,141,.6),
          0 0 60px rgba(184,252,141,.4),
          inset 0 0 10px rgba(255,255,255,.5);
        transform:scale(1);
      }
      50%{
        box-shadow:
          0 0 30px rgba(184,252,141,1),
          0 0 50px rgba(184,252,141,.8),
          0 0 80px rgba(184,252,141,.6),
          inset 0 0 15px rgba(255,255,255,.7);
        transform:scale(1.1);
      }
    }

    /* Main Content con font più grandi e spaziature migliorate */
    .main{
      text-align:center;
      padding:20px 0 40px; /* Ridotto padding top */
    }

    .headline{
      font-size:56px; /* Aumentato per desktop */
      font-weight:700;
      color:var(--neon);
      text-transform:uppercase;
      margin-bottom:12px;
      text-shadow:0 0 20px rgba(184,252,141,.3);
      line-height:1;
    }

    .subheadline{
      font-size:28px; /* Aumentato */
      font-weight:400;
      margin-bottom:10px; /* RIDOTTO */
      line-height:1.25;
    }

    .warning{
      font-size:105px; /* Più grande */
      font-weight:700;
      color:var(--red);
      text-transform:uppercase;
      margin:10px 0 5px; /* MOLTO RIDOTTO */
      text-shadow:0 0 40px rgba(255,59,59,.6);
      animation:attention 2s ease-in-out infinite;
      letter-spacing:-1px;
    }

    @keyframes attention{
      0%, 100%{transform:scale(1)}
      50%{transform:scale(1.05)}
    }

    .bonus-text{
      font-size:24px; /* Aumentato */
      margin-bottom:20px;
      margin-top:5px; /* POCO SPAZIO SOPRA */
      opacity:.95;
      line-height:1.3;
    }

    /* Video Container con più spazio sotto */
    .video-container{
      max-width:720px;
      margin:0 auto 250px; /* MOLTO PIÙ SPAZIO SOTTO */
      border-radius:20px;
      overflow:hidden;
      box-shadow:0 30px 80px rgba(0,0,0,.8);
    }

    .video-container img{
      width:100%;
      aspect-ratio:16/9;
      object-fit:cover;
      display:block;
    }

    /* Skip link sopra l'offerta */
    .skip-link{
      display:inline-block;
      margin:10px auto 25px;
      padding:8px 20px;
      color:rgba(255,255,255,.5);
      text-decoration:underline;
      font-size:14px;
      cursor:pointer;
      transition:all .3s;
      font-style:italic;
      opacity:.7;
    }

    .skip-link:hover{
      color:rgba(255,255,255,.7);
      opacity:.9;
    }

    /* Offer Box con pulsante più sottile */
    .offer-box{
      background:linear-gradient(145deg,#1a1a1a,#0a0a0a);
      border:2px solid var(--neon);
      border-radius:25px;
      padding:40px;
      margin:30px auto;
      max-width:700px;
      box-shadow:
        0 30px 70px rgba(184,252,141,.2),
        inset 0 1px 0 rgba(255,255,255,.05);
    }

    .offer-title{
      font-size:48px; /* Aumentato */
      font-weight:700;
      color:var(--neon);
      text-transform:uppercase;
      margin-bottom:12px;
      text-shadow:0 0 25px rgba(184,252,141,.3);
    }

    .offer-subtitle{
      font-size:22px; /* Aumentato */
      margin-bottom:25px;
    }

    .offer-subtitle .red{
      color:var(--red);
      font-weight:600;
    }

    .offer-list{
      text-align:left;
      margin:25px 0;
      font-size:20px; /* Aumentato */
      line-height:1.7;
    }

    .offer-list li{
      margin:12px 0;
      padding-left:30px;
      position:relative;
      list-style:none;
    }

    .offer-list li:before{
      content:"✓";
      position:absolute;
      left:0;
      color:var(--neon);
      font-weight:bold;
      font-size:22px;
    }

    /* Price */
    .price-section{
      margin:30px 0;
      text-align:center;
    }

    .price{
      font-size:92px; /* Aumentato */
      font-weight:700;
      color:var(--neon);
      text-shadow:0 0 30px rgba(184,252,141,.4);
      line-height:1;
      margin:10px 0;
    }

    .price-compare{
      font-size:22px; /* Aumentato */
      color:var(--red);
      text-decoration:line-through;
      opacity:.8;
      margin-bottom:25px;
    }

    /* Checkout Button PIÙ SOTTILE */
    .cta-checkout{
      display:block;
      width:85%;
      max-width:450px;
      padding:20px 45px; /* Ridotto come nell'optin */
      margin:30px auto 10px;
      border-radius:999px;
      border:none;
      background:linear-gradient(135deg,#FFD700,#FF8C00);
      color:#000;
      font-family:'Oswald',sans-serif;
      font-size:22px; /* Ridotto */
      font-weight:900;
      text-transform:uppercase;
      cursor:pointer;
      box-shadow:
        0 10px 25px rgba(255,215,0,.3),
        0 5px 12px rgba(255,165,0,.2),
        inset 0 1px 0 rgba(255,255,255,.4);
      transition:all .3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position:relative;
      overflow:hidden;
      letter-spacing:.8px;
      transform:perspective(1px) translateZ(0);
    }

    .cta-checkout:hover{
      transform:translateY(-4px) scale(1.03);
      box-shadow:
        0 15px 35px rgba(255,215,0,.4),
        0 8px 18px rgba(255,165,0,.25),
        inset 0 1px 0 rgba(255,255,255,.5);
    }

    .cta-checkout:before{
      content:"";
      position:absolute;
      top:-50%;
      left:-50%;
      width:200%;
      height:200%;
      background:linear-gradient(
        45deg,
        transparent 30%,
        rgba(255,255,255,.5) 50%,
        transparent 70%
      );
      transform:rotate(45deg) translateX(-100%);
      transition:transform .6s;
    }

    .cta-checkout:hover:before{
      transform:rotate(45deg) translateX(100%);
    }

    .cta-checkout:active{
      transform:translateY(-2px) scale(1.01);
    }

    /* Footer con più spazio sopra */
    footer{
      margin-top:0; /* Spazio già gestito dal video */
      padding-top:35px;
      border-top:1px solid rgba(184,252,141,.15);
      background:linear-gradient(180deg,transparent,rgba(0,0,0,1));
    }
    
    .footer-content{
      text-align:center;
      padding-bottom:10px;
    }
    
    .footer-logo{
      max-width:180px; /* Molto più piccolo */
      width:100%;
      opacity:.85;
      margin-bottom:15px;
    }
    
    .disclaimer{
      max-width:960px;
      margin:0 auto 15px;
      font-size:12px;
      line-height:1.8;
      color:rgba(255,255,255,.45);
      font-family:system-ui,sans-serif;
      padding:0 20px;
    }
    
    .footer-links{
      display:flex;
      gap:28px;
      justify-content:center;
      padding-top:14px;
      border-top:1px solid rgba(255,255,255,.1);
    }
    
    .footer-links a{
      color:rgba(255,255,255,.65);
      text-decoration:none;
      font-size:13px;
      font-family:system-ui,sans-serif;
      transition:.3s;
    }
    
    .footer-links a:hover{
      color:var(--neon);
    }

    /* Checkout Modal integrato */
    .checkout-modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.95);
      backdrop-filter:blur(20px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1000;
      padding:20px;
    }
    
    .checkout-modal.active{
      display:flex;
    }
    
    .checkout-container{
      background:linear-gradient(145deg,#1a1a1a,#050505);
      border:2px solid var(--neon);
      border-radius:30px;
      padding:40px;
      max-width:500px;
      width:100%;
      box-shadow:
        0 50px 100px rgba(184,252,141,.25),
        inset 0 1px 0 rgba(255,255,255,.05);
      position:relative;
    }
    
    .checkout-close{
      position:absolute;
      right:20px;
      top:20px;
      background:none;
      border:none;
      color:#fff;
      font-size:32px;
      cursor:pointer;
      opacity:.6;
      transition:.3s;
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    
    .checkout-close:hover{
      opacity:1;
      transform:rotate(90deg);
    }
    
    .checkout-title{
      font-size:28px;
      font-weight:700;
      color:var(--neon);
      text-align:center;
      margin-bottom:25px;
      text-transform:uppercase;
      text-shadow:0 0 20px rgba(184,252,141,.3);
    }
    
    .checkout-price{
      text-align:center;
      margin-bottom:25px;
      font-size:20px;
      opacity:.9;
    }
    
    .checkout-fields{
      margin:20px 0;
    }
    
    .checkout-field{
      margin:20px 0;
      position:relative;
    }
    
    .checkout-field label{
      position:absolute;
      top:-10px;
      left:18px;
      background:linear-gradient(90deg,#1a1a1a,#050505);
      padding:0 10px;
      font-size:11px;
      color:var(--neon);
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.8px;
      opacity:.9;
    }
    
    .checkout-field input{
      width:100%;
      padding:18px;
      border-radius:15px;
      border:1px solid rgba(184,252,141,.3);
      background:rgba(0,0,0,.6);
      color:#fff;
      font-family:'Oswald',sans-serif;
      font-size:16px;
      transition:.3s;
    }
    
    .checkout-field input:focus{
      outline:none;
      border-color:var(--neon);
      box-shadow:
        0 0 0 3px rgba(184,252,141,.15),
        0 0 30px rgba(184,252,141,.1);
    }
    
    #card-element{
      padding:18px;
      border-radius:15px;
      border:1px solid rgba(184,252,141,.3);
      background:rgba(0,0,0,.6);
      transition:.3s;
    }
    
    #card-element.StripeElement--focus{
      border-color:var(--neon);
      box-shadow:
        0 0 0 3px rgba(184,252,141,.15),
        0 0 30px rgba(184,252,141,.1);
    }
    
    .checkout-error{
      color:var(--red);
      text-align:center;
      margin:15px 0;
      font-size:14px;
      display:none;
    }
    
    .checkout-submit{
      width:100%;
      padding:22px;
      margin-top:25px;
      border:none;
      border-radius:999px;
      background:linear-gradient(135deg,#FFD700,#FF8C00);
      color:#000;
      font-family:'Oswald',sans-serif;
      font-size:20px;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.8px;
      cursor:pointer;
      box-shadow:0 20px 50px rgba(255,215,0,.5);
      transition:.3s;
    }
    
    .checkout-submit:hover:not(:disabled){
      transform:translateY(-2px);
      box-shadow:0 25px 60px rgba(255,215,0,.6);
    }
    
    .checkout-submit:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    
    .checkout-submit.processing{
      animation:pulse-gold 1.5s infinite;
    }
    
    @keyframes pulse-gold{
      50%{box-shadow:0 20px 60px rgba(255,215,0,.8)}
    }

    /* Responsive */
    @media (max-width:768px){
      .headline{font-size:42px}
      .subheadline{
        font-size:24px;
        margin-bottom:8px; /* Ridotto */
      }
      .warning{
        font-size:68px;
        margin:8px 0 5px; /* Ridotto */
      }
      .bonus-text{
        font-size:21px;
        margin-top:5px; /* Poco spazio */
        margin-bottom:18px;
      }
      .offer-box{padding:30px 25px}
      .offer-title{font-size:38px}
      .offer-list{font-size:18px}
      .price{font-size:72px}
      .cta-checkout{
        font-size:19px;
        padding:18px 40px;
        width:88%;
      }
      .video-container{
        margin-bottom:180px; /* Più spazio su tablet */
      }
      .live-pill{
        font-size:13px;
        padding:7px 18px;
      }
      .footer-logo{max-width:150px}
    }
    
    @media (max-width:480px){
      .top-banner{padding:8px 0 2px}
      .main{padding:15px 0 35px}
      .headline{
        font-size:30px;
        line-height:1.1;
        margin-bottom:10px;
        white-space:normal;
      }
      .subheadline{
        font-size:18px;
        margin-bottom:8px; /* RIDOTTO */
        white-space:normal;
        line-height:1.3;
      }
      .warning{
        font-size:44px;
        margin:8px 0 3px; /* MOLTO RIDOTTO */
        white-space:nowrap;
      }
      .bonus-text{
        font-size:16px;
        margin-bottom:15px;
        margin-top:3px; /* POCO SPAZIO */
        white-space:normal;
        line-height:1.4;
      }
      .skip-link{
        font-size:12px;
        margin:8px auto 20px;
      }
      .offer-box{
        padding:25px 18px;
        margin:25px auto;
      }
      .offer-title{
        font-size:28px;
        margin-bottom:10px;
      }
      .offer-subtitle{
        font-size:16px;
        white-space:normal;
      }
      .offer-list{
        font-size:14px;
        margin:20px 0;
      }
      .offer-list li{
        padding-left:25px;
        margin:10px 0;
      }
      .price{font-size:54px}
      .price-compare{
        font-size:17px;
        margin-bottom:20px;
      }
      .cta-checkout{
        font-size:16px;
        padding:16px 30px;
        width:90%;
        margin:25px auto 8px;
      }
      .video-container{
        margin-bottom:150px; /* Più spazio su mobile */
      }
      .live-pill{
        font-size:11px;
        padding:6px 15px;
      }
      .dot{
        width:6px;
        height:6px;
      }
      .footer-logo{max-width:120px}
    }
  </style>
</head>
<body>
  <div class="background"></div>
  <div class="grid"></div>
  
  <div class="container">
    <div class="top-banner">
      <div class="live-pill">
        <span class="dot"></span>
        EVENTO ONLINE: Giovedì 9 ottobre ore 21:00
      </div>
    </div>

    <main class="main">
      <h1 class="headline">Registrazione Confermata!</h1>
      <p class="subheadline">
        Riceverai a breve un'email con il link privato per<br>
        accedere all'evento live
      </p>

      <h2 class="warning">MA ASPETTA!</h2>
      
      <p class="bonus-text">
        Abbiamo preparato un bonus per te, guarda il video qui sotto per<br>
        vedere di cosa si tratta...
      </p>

      <div class="video-container">
        <img src="1.png" alt="Video Bonus">
      </div>

      <!-- Skip link SOPRA l'offerta -->
      <a href="/thankyou1" class="skip-link" id="skipLink">
        No grazie, non mi interessa accedere all'offerta disponibile solo su questa<br>
        pagina e voglio solo confermare la mia iscrizione
      </a>

      <div class="offer-box">
        <h3 class="offer-title">BIZ STARTER PACK</h3>
        <p class="offer-subtitle">
          Accedi alle lezioni esclusive + BONUS<br>
          <span class="red">(DISPONIBILE SOLO SU QUESTA PAGINA)</span>
        </p>

        <ul class="offer-list">
          <li>Come fare i tuoi primi 100€ al giorno attraverso un personal brand</li>
          <li>Come iniziare senza doverci mettere la faccia - 2 strategie che noi utilizziamo</li>
          <li>Tutti i tool AI per creare degli avatar digitali che sembrano persone reali</li>
          <li>[BOUNS] CASO STUDIO: Come abbiamo fatto 150.000€ in 2 ore lanciando un prodotto digitale</li>
          <li>[BONUS] Replica dell'evento</li>
        </ul>

        <div class="price-section">
          <div class="price">50€</div>
          <div class="price-compare">AL POSTO DI 200€</div>
        </div>

        <!-- Pulsante DENTRO il box -->
        <button class="cta-checkout" id="checkoutBtn">
          → ACCEDI ORA ←
        </button>
      </div>
    </main>

    <footer>
      <div class="footer-content">
        <img class="footer-logo" src="2.webp" alt="Logo">
        <p class="disclaimer">
          I nostri risultati e quelli dei miei studenti non sono tipici. Acquistando o accedendo ai contenuti gratuiti di infobiz.com potrai guadagnare di meno o di più rispetto ai risultati che vedi. Tutti i business comportano rischi e tempo per consolidarsi. Se stai cercando guadagni facili questo NON fa per te. Lasciando i tuoi dati accetti la Privacy Policy del sito.
        </p>
        <div class="footer-links">
          <a href="https://learn.infobiz.com/privacy-policy-2/" target="_blank">Privacy Policy</a>
          <a href="https://learn.infobiz.com/cookie-policy/" target="_blank">Cookie Policy</a>
          <a href="https://learn.infobiz.com/terms-of-service/" target="_blank">Terms of Service</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Modal Checkout integrato -->
  <div class="checkout-modal" id="checkoutModal">
    <div class="checkout-container">
      <button class="checkout-close" onclick="closeCheckout()">&times;</button>
      <h3 class="checkout-title">Completa l'acquisto</h3>
      <p class="checkout-price">Biz Starter Pack - <strong style="color:var(--neon)">50€</strong></p>
      
      <form id="payment-form">
        <div class="checkout-fields">
          <div class="checkout-field">
            <label>EMAIL</label>
            <input type="email" id="checkout-email" required>
          </div>
          
          <div class="checkout-field">
            <label>NOME COMPLETO</label>
            <input type="text" id="checkout-name" required>
          </div>
          
          <div class="checkout-field">
            <label>CARTA</label>
            <div id="card-element"></div>
          </div>
        </div>
        
        <div class="checkout-error" id="card-errors"></div>
        
        <button type="submit" class="checkout-submit" id="submit-payment">
          ACCEDI ORA
        </button>
      </form>
    </div>
  </div>

  <script>
    // Recupera i dati salvati dall'optin
    const userData = {
      name: sessionStorage.getItem('user_name') || '',
      email: sessionStorage.getItem('user_email') || '',
      phone: sessionStorage.getItem('user_phone') || ''
    };

    console.log('Dati utente recuperati:', userData);

    // Stripe configuration
    const STRIPE_PUBLIC_KEY = 'pk_live_51IDw0AE9CzAMobs3J8gGyyQBkOK9GhUO1VIIb0RveSzQ3cv0qao4q14hwVe168gTx1WCn89Qvj1J8JR8l0iMnBNZ00iU2yhcKT';
    
    // Inizializza Stripe e Elements
    const stripe = Stripe(STRIPE_PUBLIC_KEY);
    const elements = stripe.elements({
      fonts: [{
        cssSrc: 'https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap'
      }]
    });
    
    // Stile per card element
    const cardStyle = {
      base: {
        color: '#fff',
        fontFamily: 'Oswald, sans-serif',
        fontSize: '16px',
        '::placeholder': {
          color: 'rgba(255,255,255,0.4)'
        }
      },
      invalid: {
        color: '#FF3B3B',
        iconColor: '#FF3B3B'
      }
    };
    
    // Crea card element
    const cardElement = elements.create('card', {style: cardStyle});
    
    // Funzioni modal
    function openCheckout() {
      document.getElementById('checkoutModal').classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // Pre-compila i dati
      document.getElementById('checkout-email').value = userData.email;
      document.getElementById('checkout-name').value = userData.name;
      
      // Monta card element
      cardElement.mount('#card-element');
      
      // Track evento
      if (typeof fbq !== 'undefined') {
        fbq('track', 'InitiateCheckout', {
          value: 50.00,
          currency: 'EUR'
        });
      }
    }
    
    function closeCheckout() {
      document.getElementById('checkoutModal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }
    
    // Gestione apertura checkout
    document.getElementById('checkoutBtn').addEventListener('click', openCheckout);
    
    // Gestione errori card
    cardElement.on('change', function(event) {
      const displayError = document.getElementById('card-errors');
      if (event.error) {
        displayError.textContent = event.error.message;
        displayError.style.display = 'block';
      } else {
        displayError.textContent = '';
        displayError.style.display = 'none';
      }
    });
    
    // Gestione form pagamento
    const form = document.getElementById('payment-form');
    form.addEventListener('submit', async function(event) {
      event.preventDefault();
      
      const submitButton = document.getElementById('submit-payment');
      const errorElement = document.getElementById('card-errors');
      
      // Disabilita pulsante
      submitButton.disabled = true;
      submitButton.classList.add('processing');
      submitButton.textContent = 'Elaborazione...';
      
      try {
        // Crea payment method
        const {paymentMethod, error} = await stripe.createPaymentMethod({
          type: 'card',
          card: cardElement,
          billing_details: {
            name: document.getElementById('checkout-name').value,
            email: document.getElementById('checkout-email').value
          }
        });
        
        if (error) {
          throw new Error(error.message);
        }
        
        // Invia al backend
        const response = await fetch('/.netlify/functions/process-payment', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            paymentMethodId: paymentMethod.id,
            amount: 5000, // 50€ in centesimi
            currency: 'eur',
            customerEmail: document.getElementById('checkout-email').value,
            customerName: document.getElementById('checkout-name').value,
            product: 'biz_starter_pack'
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Salva il payment method per l'OTO2 (one-click)
          sessionStorage.setItem('payment_method_id', paymentMethod.id);
          
          // Pagamento riuscito
          if (typeof fbq !== 'undefined') {
            fbq('track', 'Purchase', {
              value: 50.00,
              currency: 'EUR'
            });
          }
          window.location.href = '/oto2';
        } else if (result.requiresAction) {
          // Richiede 3D Secure
          const {error} = await stripe.confirmCardPayment(result.clientSecret);
          if (error) {
            throw new Error(error.message);
          } else {
            // Salva il payment method anche dopo 3D Secure
            sessionStorage.setItem('payment_method_id', paymentMethod.id);
            
            // Pagamento confermato
            if (typeof fbq !== 'undefined') {
              fbq('track', 'Purchase', {
                value: 50.00,
                currency: 'EUR'
              });
            }
            window.location.href = '/oto2';
          }
        } else {
          throw new Error(result.error || 'Pagamento non riuscito');
        }
        
      } catch (error) {
        errorElement.textContent = error.message;
        errorElement.style.display = 'block';
        submitButton.disabled = false;
        submitButton.classList.remove('processing');
        submitButton.textContent = 'ACCEDI ORA';
      }
    });

    // Skip link
    document.getElementById('skipLink').addEventListener('click', function(e) {
      e.preventDefault();
      
      // Track rifiuto offerta
      if (typeof fbq !== 'undefined') {
        fbq('trackCustom', 'SkipOTO1');
      }
      
      window.location.href = '/thankyou1';
    });
    
    // Chiudi modal con ESC
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('checkoutModal').classList.contains('active')) {
        closeCheckout();
      }
    });

    // Auto-scroll al caricamento per mobile
    if (window.innerWidth < 768) {
      setTimeout(() => {
        window.scrollTo({
          top: document.querySelector('.headline').offsetTop - 20,
          behavior: 'smooth'
        });
      }, 500);
    }
  </script>
</body>
</html>